<!DOCTYPE html>
<html data-layout-decorate="~{fragments/layout}" lang="en">
<head>
    <!-- jQuery is REQUIRED for Bootstrap 3 -->
    <script th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <!-- Bootstrap JS -->
    <script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>

    <link rel="stylesheet" th:href="@{/css/steps-trans.css}">
    <script th:src="@{/js/stepTrans/stepTrans.js}"></script>
    <title></title>
</head>


<body>
<div class="right_col" data-layout-fragment="content" role="main">
    <div class="row">
        <div class="col-sm-12">
            <!--<div class="container">-->
            <div class="panel panel-default">
                <!-- Default panel contents -->
                <div class="panel-heading">Step Transaction</div>
                <div class="panel-body">
                    <form method="post"
                          th:action="@{/step-trans/create/{pageId}/{tempDtlId}
                          (pageId=${pageId},tempDtlId=${tempDtlId},page=${page},size=${size})}"
                          th:object="${stepTransReq}">
                        <!-- Template Row -->
                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="templateid">Template Id</label>
                            <div class="col-sm-1">
                                <b>:</b>
                            </div>
                            <div class="col-sm-4">
                                <input class="form-control" id="templateid" placeholder="Template Id" readonly
                                       th:value="${tempDtlId}" type="hidden"/>
                                <input class="form-control" id="templateName" placeholder="Template Id" readonly
                                       th:value="${userAccessTempltDtl.userAccessTemltDesc}" type="text"/>
                            </div>

                            <div class="col-sm-4">
                                <!--                                th:disabled="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <select class="form-control"
                                        id="stepSetupList"
                                        required
                                        th:field="${stepTransReq.stepSetupId}">
                                    <!--                                    <div th:if="${#lists.size(stepSetupList) &gt; 1}">-->
                                    <!--                                        <option value="">&#45;&#45; Select &#45;&#45;</option>-->
                                    <!--                                    </div>-->
                                    <div th:if="${stepSetupList != null and #lists.size(stepSetupList) > 1}">
                                        <option value="">-- Select --</option>
                                    </div>
                                    <option th:each="stepSetup : ${stepSetupList}"
                                            th:text="${stepSetup.description}"
                                            th:value="${stepSetup.stepSetupId}">
                                    </option>
                                </select>

                                <!--                                <input id="Setup Id" class="form-control" readonly-->
                                <!--                                       placeholder="Setup Id" required-->
                                <!--                                       th:field="${stepSetupDetailsResponse.stepSetupId}" type="text">-->
                            </div>
                        </div>

                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="vhCtyResList">Vehicle Info</label>
                            <div class="col-sm-1"><b>:</b></div>

                            <div class="col-sm-3">
                                <!--                                th:disabled="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <select class="form-control"
                                        id="vhCtyResList"
                                        required
                                        th:field="${stepTransReq.vehicleCity}">
                                    <option value="">-- Select --</option>
                                    <option th:each="vhCty : ${vhCtyResList}"
                                            th:text="${vhCty.vhCtyName}"
                                            th:value="${vhCty.vhCtyName}"></option>
                                </select>
                            </div>

                            <div class="col-sm-2">
                                <!--                                th:disabled="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <select class="form-control"
                                        id="vhCtyClsResList"
                                        required
                                        th:field="${stepTransReq.vehicleCityClass}">
                                    <option value="">-- Select --</option>
                                    <option th:each="vhCtyCls : ${vhCtyClsResList}"
                                            th:text="${vhCtyCls.vhCtyClassName}"
                                            th:value="${vhCtyCls.vhCtyClassName}"></option>
                                </select>
                            </div>

                            <div class="col-sm-3">
                                <!--                                th:readonly="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <input class="form-control"
                                       id="vehicleNo"
                                       inputmode="numeric"
                                       oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                                       pattern="[0-9]+"
                                       placeholder="Enter Vehicle No"
                                       required
                                       th:field="${stepTransReq.vehicleNumber}"
                                       type="text"/>
                            </div>
                        </div>


                        <!-- Transport Name -->
                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="transportName">Transport Name</label>
                            <div class="col-sm-1">
                                <b>:</b>
                            </div>
                            <div class="col-sm-8">
                                <!--                                th:readonly="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <input class="form-control" id="transportName"
                                       placeholder="Enter Transport Name" required
                                       th:field="${stepTransReq.transportName}"
                                       type="text">
                            </div>
                        </div>

                        <!-- Driver Name -->
                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="driverName">Driver Name</label>
                            <div class="col-sm-1">
                                <b>:</b>
                            </div>
                            <div class="col-sm-8">
                                <!--                                th:readonly="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <input class="form-control" id="driverName"
                                       placeholder="Enter Driver Name" required
                                       th:field="${stepTransReq.driverName}"

                                       type="text">
                            </div>
                        </div>

                        <!-- Driver Phone -->
                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="driverPhone">Driver Phone</label>
                            <div class="col-sm-1">
                                <b>:</b>
                            </div>
                            <div class="col-sm-8">
                                <!--                                th:readonly="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <input class="form-control"
                                       id="driverPhone"
                                       inputmode="numeric"
                                       maxlength="11"
                                       minlength="11"
                                       oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 11);"
                                       pattern="[0-9]{11}"
                                       placeholder="Enter Driver Phone"
                                       required
                                       th:field="${stepTransReq.driverPhoneNo}"
                                       type="text">

                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="form-group col-sm-12 Padding10px">
                            <button class="btn btn-primary"
                                    th:text="${stepTransReq.stepTransId!= null ? 'Update' : 'Create'}"
                                    type="submit"></button>

                            <a class="btn cancel-btn"
                               th:href="@{/step-trans/{pageId}/{tempDtlId}
                               (pageId=${pageId},tempDtlId=${tempDtlId},page=${page},size=${size})}">Clear</a>
                        </div>

                    </form>

                    <div class="steps-container"
                         th:if="${stepWiseTransCount != null and #lists.size(stepWiseTransCount) > 1}">

                        <div class="step-row">
                            <div class="step-inline" th:each="step, iter : ${stepWiseTransCount}">


                                <div class="step-card"
                                     onclick="openStepModal(this)"
                                     th:data-setup-Dtl-Id="${step.stepSetupDetailsId}">
                                    <span class="badge" th:text="${step.curStepCount}">0</span>
                                    <span class="step-name" th:text="${step.curStepName}">Next</span>
                                </div>

                                <!-- arrow except last item -->
                                <span class="step-arrow" th:if="${!iter.last}">→</span>
                            </div>
                        </div>
                    </div>

                    <div class="steps-container"
                         th:each="step : ${stepWiseTransCount}"
                         th:unless="${stepWiseTransCount != null and #lists.size(stepWiseTransCount) > 1}">

                        <div class="step-row">
                            <!-- PREVIOUS -->
                            <div class="step-card" onclick="openStepModal(this)"
                                 th:data-setup-Dtl-Id="${step.pStepSetupDetailsId}"
                                 th:if="${step.pStepSetupDetailsId!=null}">
                                <span class="badge" th:text="${step.prevStepCount}">0</span>
                                <span class="step-name" th:text="${step.prevStepName}">Prev</span>
                            </div>

                            <span class="step-arrow" th:if="${step.pStepSetupDetailsId!=null}">→</span>

                            <!-- CURRENT -->
                            <div class="step-card" onclick="openStepModal(this)"
                                 th:data-setup-Dtl-Id="${step.stepSetupDetailsId}">
                                <span class="step-name" th:text="${step.curStepName}">Current</span>
                            </div>

                            <span class="step-arrow" th:if="${step.fStepSetupDetailsId!=null}">→</span>

                            <!-- FORWARD -->
                            <div class="step-card" onclick="openStepModal(this)"
                                 th:data-setup-Dtl-Id="${step.fStepSetupDetailsId}"
                                 th:if="${step.fStepSetupDetailsId!=null}">
                                <span class="badge" th:text="${step.forwStepCount}">0</span>
                                <span class="step-name" th:text="${step.forwStepName}">Next</span>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL START-->
                    <div class="modal fade" id="stepTimelineModal" role="dialog" tabindex="-1">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h4 class="modal-title">Step Timeline</h4>
                                </div>
                                <div class="modal-body">
                                    <table class="table table-bordered table-condensed">
                                        <thead>
                                        <tr>
                                            <th>Vehicle</th>
                                            <th>New</th>
                                            <th>Picked</th>
                                            <th>WIP</th>
                                            <!--                                            <th>Ignition Time</th>-->
                                        </tr>
                                        </thead>
                                        <tbody id="timelineTableBody">
                                        <!-- Data will be inserted here -->
                                        </tbody>
                                    </table>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END MODAL -->
                    <div class="form-group col-sm-12">
                        <table class="table table-hover table-bordered custom-gray-table text-dark text-center">
                            <thead>
                            <tr>
                                <th>TransNo</th>
                                <th>LinesNo</th>
                                <th>VehicleNo</th>
                                <th>Driver Name</th>
                                <th>Step</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr th:each="line, stat : ${stepTransResponseList.getContent()}">
                                <td th:text="${line.stepTransNo}"></td>
                                <td th:text="${line.stepTransLinesNo}"></td>
                                <td th:text="${line.vehicleNumber}"></td>
                                <td th:text="${line.driverName}"></td>
                                <td th:text="${line.stepName}"></td>
                                <td class="text-center" th:text="${line.stepStatus}"></td>
                                <td class="text-center">

                                    <a class="btn view-btn btn-success"
                                       th:href="@{'/step-trans/update-lines/{pageId}/{tempDtlId}'
                                       (pageId=${pageId}, tempDtlId=${tempDtlId}, stepTransLinesId=${line.stepTransLinesId}, stepStatus='Complete',page=${page},size=${size})}"
                                       th:if="${line.stage == 2}">
                                        Release
                                    </a>

                                    <a class="btn edit-btn btn-warning"
                                       th:href="@{'/step-trans/update-lines/{pageId}/{tempDtlId}'
                                       (pageId=${pageId}, tempDtlId=${tempDtlId}, stepTransLinesId=${line.stepTransLinesId},stepStatus='WIP',page=${page},size=${size})}"
                                       th:if="${line.stage == 1 and line.stepStatus != 'WIP'}">
                                        WIP
                                    </a>

                                    <a class="btn pick-btn btn-info"
                                       th:href="@{'/step-trans/update-lines/{pageId}/{tempDtlId}'
                                       (pageId=${pageId}, tempDtlId=${tempDtlId}, stepTransLinesId=${line.stepTransLinesId}, stepStatus='Pick',page=${page},size=${size})}"
                                       th:if="${line.stage == 0 and line.stepStatus != 'Pick'}">
                                        Pick
                                    </a>

                                    <a class="btn delete-btn btn-danger"
                                       th:href="@{'/step-trans/update-lines/{pageId}/{tempDtlId}'
                                       (pageId=${pageId}, tempDtlId=${tempDtlId}, stepTransLinesId=${line.stepTransLinesId}, stepStatus='Reject',page=${page},size=${size})}"
                                       th:if="${line.stage == 2}">
                                        Reject
                                    </a>
                                    <a class="btn btn-success"
                                       th:href="@{'/step-trans-dtl/{pageId}/{tempDtlId}/{orgId}/{invOrgId}/{stepTransId}'(pageId=${pageId},tempDtlId=${tempDtlId},orgId=${orgId},invOrgId=${invOrgId},stepTransId=${line.stepTransId})}"><span
                                            aria-hidden="true" class="glyphicon glyphicon-info-sign"></span></a>

                                </td>
                            </tr>
                            </tbody>
                        </table>

                        <!-- Pagination -->
                        <nav aria-label="Page navigation" class="text-left"
                             th:if="${stepTransResponseList.totalPages > 1}">
                            <ul class="pagination">
                                <!-- Previous -->
                                <li th:classappend="${!stepTransResponseList.hasPrevious()} ? 'disabled'">
                                    <a aria-label="Previous"
                                       th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=${stepTransResponseList.number - 1}, size=${stepTransResponseList.size})}"
                                       th:if="${stepTransResponseList.hasPrevious()}">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                    <span th:unless="${stepTransResponseList.hasPrevious()}">&laquo;</span>
                                </li>

                                <!-- First page -->
                                <li th:if="${stepTransResponseList.number > 2}">
                                    <a th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=0, size=${stepTransResponseList.size})}">1</a>
                                </li>
                                <li class="disabled" th:if="${stepTransResponseList.number > 3}">
                                    <span>...</span>
                                </li>

                                <!-- Pages around current -->
                                <li th:classappend="${i == stepTransResponseList.number} ? 'active'"
                                    th:each="i : ${#numbers.sequence(
                        (stepTransResponseList.number > 1 ? stepTransResponseList.number : 0),
                        (stepTransResponseList.number < stepTransResponseList.totalPages - 2 ? stepTransResponseList.number + 1 : stepTransResponseList.totalPages - 1)
                    )}">
                                    <a th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=${i}, size=${stepTransResponseList.size})}"
                                       th:text="${i + 1}"></a>
                                </li>

                                <!-- Last page -->
                                <li class="disabled"
                                    th:if="${stepTransResponseList.number < stepTransResponseList.totalPages - 3}">
                                    <span>...</span>
                                </li>
                                <li th:if="${stepTransResponseList.number < stepTransResponseList.totalPages - 2}">
                                    <a th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=${stepTransResponseList.totalPages - 1}, size=${stepTransResponseList.size})}"
                                       th:text="${stepTransResponseList.totalPages}">
                                    </a>
                                </li>

                                <!-- Next -->
                                <li th:classappend="${!stepTransResponseList.hasNext()} ? 'disabled'">
                                    <a aria-label="Next"
                                       th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=${stepTransResponseList.number + 1}, size=${stepTransResponseList.size})}"
                                       th:if="${stepTransResponseList.hasNext()}">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                    <span th:unless="${stepTransResponseList.hasNext()}">&raquo;</span>
                                </li>

                            </ul>
                        </nav>

                    </div>
                    <div class="panel-footer"></div>
                </div>

            </div>
        </div>
    </div>
</div>
</body>
</html>
