<!DOCTYPE html>
<html data-layout-decorate="~{fragments/layout}" lang="en">
<head>
    <link rel="stylesheet" th:href="@{/css/steps-trans.css}">
    <title></title>
    <style>
        .step-line {
            padding: 6px 0;
            border-bottom: 1px solid #e5e5e5;
            font-size: 14px;
        }
        .step-count {
            font-size: 13px;
            color: #666;
            margin-left: 6px;
        }
        .step-arrow {
            margin: 0 8px;
            color: #999;
        }
    </style>
</head>



<body>
<div class="right_col" data-layout-fragment="content" role="main">
    <div class="row">
        <div class="col-sm-12">
            <!--<div class="container">-->
            <div class="panel panel-default">
                <!-- Default panel contents -->
                <div class="panel-heading">Step Transaction</div>
                <div class="panel-body">
                    <form method="post"
                          th:action="@{/step-trans/create/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId})}"
                          th:object="${stepTransReq}">
                        <!-- Template Row -->
                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="templateid">Template Id</label>
                            <div class="col-sm-1">
                                <b>:</b>
                            </div>
                            <div class="col-sm-4">
                                <input class="form-control" id="templateid" placeholder="Template Id" readonly
                                       th:value="${tempDtlId}" type="hidden"/>
                                <input class="form-control" id="templateName" placeholder="Template Id" readonly
                                       th:value="${userAccessTempltDtl.userAccessTemltDesc}" type="text"/>
                            </div>

                            <div class="col-sm-4">
                                <!--                                th:disabled="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <select  class="form-control"
                                        id="stepSetupList"
                                        required
                                        th:field="${stepTransReq.stepSetupId}">
                                    <div th:if="${#lists.size(stepSetupList) &gt; 1}">
                                        <option value="">-- Select --</option>
                                    </div>
                                    <option th:each="stepSetup : ${stepSetupList}"
                                            th:text="${stepSetup.description}"
                                            th:value="${stepSetup.stepSetupId}">
                                    </option>
                                </select>

                                <!--                                <input id="Setup Id" class="form-control" readonly-->
                                <!--                                       placeholder="Setup Id" required-->
                                <!--                                       th:field="${stepSetupDetailsResponse.stepSetupId}" type="text">-->
                            </div>
                        </div>

                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="vhCtyResList">Vehicle Info</label>
                            <div class="col-sm-1"><b>:</b></div>

                            <div class="col-sm-3">
                                <!--                                th:disabled="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <select class="form-control"
                                        id="vhCtyResList"
                                        required

                                        th:field="${stepTransReq.vehicleCity}">
                                    <option value="">-- Select --</option>
                                    <option th:each="vhCty : ${vhCtyResList}"
                                            th:text="${vhCty.vhCtyName}"
                                            th:value="${vhCty.vhCtyName}"></option>
                                </select>
                            </div>

                            <div class="col-sm-2">
                                <!--                                th:disabled="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <select class="form-control"
                                        id="vhCtyClsResList"
                                        required

                                        th:field="${stepTransReq.vehicleCityClass}">
                                    <option value="">-- Select --</option>
                                    <option th:each="vhCtyCls : ${vhCtyClsResList}"
                                            th:text="${vhCtyCls.vhCtyClassName}"
                                            th:value="${vhCtyCls.vhCtyClassName}"></option>
                                </select>
                            </div>

                            <div class="col-sm-3">
                                <!--                                th:readonly="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <input class="form-control"
                                       id="vehicleNo"
                                       placeholder="Enter Vehicle No"
                                       required
                                       th:field="${stepTransReq.vehicleNumber}"
                                       type="text"/>
                            </div>
                        </div>


                        <!-- Transport Name -->
                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="transportName">Transport Name</label>
                            <div class="col-sm-1">
                                <b>:</b>
                            </div>
                            <div class="col-sm-8">
                                <!--                                th:readonly="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <input class="form-control" id="transportName"
                                       placeholder="Enter Transport Name" required
                                       th:field="${stepTransReq.transportName}"

                                       type="text">
                            </div>
                        </div>

                        <!-- Driver Name -->
                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="driverName">Driver Name</label>
                            <div class="col-sm-1">
                                <b>:</b>
                            </div>
                            <div class="col-sm-8">
                                <!--                                th:readonly="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <input class="form-control" id="driverName"
                                       placeholder="Enter Driver" required
                                       th:field="${stepTransReq.driverName}"

                                       type="text">
                            </div>
                        </div>

                        <!-- Driver Phone -->
                        <div class="form-group col-sm-12">
                            <label class="col-sm-3 control-label" for="driverPhone">Driver Phone</label>
                            <div class="col-sm-1">
                                <b>:</b>
                            </div>
                            <div class="col-sm-8">
                                <!--                                th:readonly="${stepSetupDetailsResponse.serialNo != 1}"-->
                                <input class="form-control" id="driverPhone"
                                       placeholder="Enter Driver Phone" required

                                       th:field="${stepTransReq.driverPhoneNo}" type="text">
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="form-group col-sm-12 Padding10px">
                            <button class="btn btn-primary"
                                    th:text="${stepTransReq.stepTransNo!= null ? 'Update' : 'Create'}"
                                    type="submit"></button>

                            <a class="btn cancel-btn"
                               th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId})}">Clear</a>
                        </div>

                    </form>
                    <div class="container mt-3">
                        <h6 class="mb-2">Step Flow</h6>

                        <div th:each="step : ${stepWiseTransCount}" class="step-line d-flex align-items-center">

                            <span th:text="${step.prevStepName}">Prev</span>
                            <span class="step-count" th:text="'(' + ${step.prevStepCount} + ')'">(0)</span>

                            <span class="step-arrow">→</span>

                            <strong th:text="${step.curStepName}">Current</strong>

                            <span class="step-arrow">→</span>

                            <span th:text="${step.forwStepName}">Next</span>
                            <span class="step-count" th:text="'(' + ${step.forwStepCount} + ')'">(0)</span>

                        </div>

                        <div th:if="${#lists.isEmpty(stepWiseTransCount)}" class="text-muted small mt-2">
                            No data available
                        </div>
                    </div>

                    <div class="form-group col-sm-12">
                        <table class="table table-hover table-bordered custom-gray-table text-dark text-center">
                        <thead>
                            <tr>
                                <th>TransNo</th>
                                <th>LinesNo</th>
                                <th>VehicleNo</th>
                                <th>Driver Name</th>
                                <th>Step</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr th:each="line, stat : ${stepTransResponseList.getContent()}">
                                <td th:text="${line.stepTransNo}"></td>
                                <td th:text="${line.stepTransLinesNo}"></td>
                                <td th:text="${line.vehicleNumber}"></td>
                                <td th:text="${line.driverName}"></td>
                                <td  th:text="${line.stepName}"></td>
                                <td class="text-center" th:text="${line.stepStatus}"></td>
                                <td class="text-center">

                                    <a class="btn view-btn btn-success"
                                       th:href="@{'/step-trans/update-lines/{pageId}/{tempDtlId}'(pageId=${pageId}, tempDtlId=${tempDtlId}, stepTransLinesNo=${line.stepTransLinesNo}, stepStatus='Complete')}"
                                       th:if="${line.stage == 2}">
                                        Release
                                    </a>

                                    <a class="btn edit-btn btn-warning"
                                       th:href="@{'/step-trans/update-lines/{pageId}/{tempDtlId}'(pageId=${pageId}, tempDtlId=${tempDtlId}, stepTransLinesNo=${line.stepTransLinesNo}, stepStatus='WIP')}"
                                       th:if="${line.stage == 1 and line.stepStatus != 'WIP'}">
                                        WIP
                                    </a>

                                    <a class="btn pick-btn btn-info"
                                       th:href="@{'/step-trans/update-lines/{pageId}/{tempDtlId}'(pageId=${pageId}, tempDtlId=${tempDtlId}, stepTransLinesNo=${line.stepTransLinesNo}, stepStatus='Pick')}"
                                       th:if="${line.stage == 0 and line.stepStatus != 'Pick'}">
                                        Pick
                                    </a>

                                    <a class="btn delete-btn btn-danger"
                                       th:if="${line.stage == 2}"
                                       th:href="@{'/step-trans/update-lines/{pageId}/{tempDtlId}'(pageId=${pageId}, tempDtlId=${tempDtlId}, stepTransLinesNo=${line.stepTransLinesNo}, stepStatus='Reject')}">
                                        Reject
                                    </a>

                                </td>
                            </tr>
                            </tbody>
                        </table>

                        <!-- Pagination -->
                        <nav th:if="${stepTransResponseList.totalPages > 1}" aria-label="Page navigation" class="text-left">
                            <ul class="pagination">
                                <!-- Previous -->
                                <li th:classappend="${!stepTransResponseList.hasPrevious()} ? 'disabled'">
                                    <a th:if="${stepTransResponseList.hasPrevious()}"
                                       th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=${stepTransResponseList.number - 1}, size=${stepTransResponseList.size})}"
                                       aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                    <span th:unless="${stepTransResponseList.hasPrevious()}">&laquo;</span>
                                </li>

                                <!-- First page -->
                                <li th:if="${stepTransResponseList.number > 2}">
                                    <a th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=0, size=${stepTransResponseList.size})}">1</a>
                                </li>
                                <li class="disabled" th:if="${stepTransResponseList.number > 3}">
                                    <span>...</span>
                                </li>

                                <!-- Pages around current -->
                                <li th:each="i : ${#numbers.sequence(
                        (stepTransResponseList.number > 1 ? stepTransResponseList.number : 0),
                        (stepTransResponseList.number < stepTransResponseList.totalPages - 2 ? stepTransResponseList.number + 1 : stepTransResponseList.totalPages - 1)
                    )}"
                                    th:classappend="${i == stepTransResponseList.number} ? 'active'">
                                    <a th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=${i}, size=${stepTransResponseList.size})}"
                                       th:text="${i + 1}"></a>
                                </li>

                                <!-- Last page -->
                                <li class="disabled" th:if="${stepTransResponseList.number < stepTransResponseList.totalPages - 3}">
                                    <span>...</span>
                                </li>
                                <li th:if="${stepTransResponseList.number < stepTransResponseList.totalPages - 2}">
                                    <a th:text="${stepTransResponseList.totalPages}"
                                       th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=${stepTransResponseList.totalPages - 1}, size=${stepTransResponseList.size})}">
                                    </a>
                                </li>

                                <!-- Next -->
                                <li th:classappend="${!stepTransResponseList.hasNext()} ? 'disabled'">
                                    <a th:if="${stepTransResponseList.hasNext()}"
                                       th:href="@{/step-trans/{pageId}/{tempDtlId}(pageId=${pageId}, tempDtlId=${tempDtlId}, page=${stepTransResponseList.number + 1}, size=${stepTransResponseList.size})}"
                                       aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                    <span th:unless="${stepTransResponseList.hasNext()}">&raquo;</span>
                                </li>

                            </ul>
                        </nav>

                    </div>
                    <div class="panel-footer"></div>
                </div>

            </div>
        </div>
    </div>

</body>
</html>
